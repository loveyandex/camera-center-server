<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Camera Event Stream</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6 font-sans">
  <h1 class="text-3xl font-bold text-gray-800 mb-6">ðŸ“¡ Live Camera Events</h1>
  <div id="events" class="space-y-4 max-h-[600px] overflow-y-auto"></div>

  <script>
    const cameraFilter = ""; // e.g. "cam_001,cam_002" or leave empty for all
    const wsURL = `ws://localhost:8080/ws${cameraFilter ? "?camera_id=" + cameraFilter : ""}`;
    const socket = new WebSocket(wsURL);

    const eventsDiv = document.getElementById("events");

    socket.onopen = () => {
      console.log("WebSocket connected:", wsURL);
    };

    socket.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);

        console.log(data)
        const e = data.event;
        const div = document.createElement("div");
        div.className = "bg-white shadow-md rounded-lg p-4 border border-gray-200";

        div.innerHTML = `
          <div class="text-lg font-semibold text-indigo-600">${e.event_type}</div>
          <div class="text-sm text-gray-500 mb-2">${new Date(e.timestamp * 1000).toLocaleString()}</div>
          <div class="text-gray-700">
            <p><span class="font-medium">Camera:</span> ${e.camera_id}</p>
            <p><span class="font-medium">AI Engine:</span> ${e.ai_engine_id}</p>
            <p><span class="font-medium">Confidence:</span> ${e.confidence}</p>
            <p><span class="font-medium">Details:</span> ${e.details}</p>
          </div>
          <div class="text-xs text-gray-400 mt-2">Source: ${data.source}</div>
        `;
        eventsDiv.prepend(div);
      } catch (err) {
        console.error("Invalid message:", event.data);
      }
    };

    socket.onerror = (err) => {
      console.error("WebSocket error:", err);
    };

    socket.onclose = () => {
      console.warn("WebSocket closed");
    };
  </script>
</body>
</html>
